<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="debug" strict="true" name="XMLConfigTest"
               packages="org.apache.logging.log4j.test">
    <Filter type="ThresholdFilter" level="trace" />

    <appenders>
        <Console name="STDOUT" target="SYSTEM_OUT">
            <ThresholdFilter level="INFO" onMatch="ACCEPT" onMismatch="DENY" />
            <PatternLayout pattern="%d{HH:mm:ss.SSS} [%X{req_id}] [%t] %-5level - %msg - [%logger{36}:%M:%L] %n" />
        </Console>
        <!-- main file -->
        <RollingRandomAccessFile name="RoFile" fileName="logs/service.log"
                                 filePattern="logs/$${date:yyyy-MM-dd}/service-%d{yyyy-MM-dd-HH}-%i.log.gz">
            <ThresholdFilter level="INFO" onMatch="ACCEPT" onMismatch="DENY"/>
            <PatternLayout pattern="%d{yyyy.MM.dd HH:mm:ss.SSS} [%X{req_id}] [%t] %-5level - %msg - [%logger{36}:%M:%L] %n" />
            <Policies>
                <TimeBasedTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="256 MB" />
            </Policies>
            <DefaultRolloverStrategy max="100" />
        </RollingRandomAccessFile>
        <!-- error file -->
        <RollingRandomAccessFile name="RoErrorFile" fileName="logs/error.log"
                                 filePattern="logs/$${date:yyyy-MM-dd}/error-%d{yyyy-MM-dd}-%i.log.gz">
            <ThresholdFilter level="ERROR" onMatch="ACCEPT" onMismatch="DENY"/>
            <PatternLayout pattern="%d{yyyy.MM.dd HH:mm:ss.SSS} [%X{req_id}] [%t] %-5level - %msg - [%logger{36}:%M:%L] %n" />
            <Policies>
                <TimeBasedTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="256 MB" />
            </Policies>
            <DefaultRolloverStrategy max="100" />
        </RollingRandomAccessFile>
        <!-- app file -->
        <RollingRandomAccessFile name="AppLogFile" fileName="logs/app.log"
                                 filePattern="logs/$${date:yyyy-MM-dd}/app-%d{yyyy-MM-dd-HH}-%i.log.gz">
            <ThresholdFilter level="DEBUG" onMatch="ACCEPT" onMismatch="DENY"/>
            <PatternLayout pattern="%d{yyyy.MM.dd HH:mm:ss.SSS} [%X{req_id}] [%t] %-5level - %msg - [%logger{36}:%M:%L] %n" />
            <Policies>
                <TimeBasedTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="256 MB" />
            </Policies>
            <DefaultRolloverStrategy max="100" />
        </RollingRandomAccessFile>

        <RollingFile name="RequestLogFile" fileName="reqlogs/req.log"
                     filePattern="reqlogs/$${date:yyyy-MM-dd}/req-%d{yyyy-MM-dd}-%i.log">
            <PatternLayout pattern="%msg%n" />
            <Policies>
                <TimeBasedTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="256 MB" />
            </Policies>
            <DefaultRolloverStrategy max="1000" />
        </RollingFile>

    </appenders>
    <loggers>
        <Logger name="org" level="WARN" additivity="true">
            <AppenderRef ref="RoFile" />
        </Logger>
        <Logger name="org.hibernate" level="WARN" additivity="true">
            <AppenderRef ref="RoFile" />
        </Logger>
        <Logger name="java.sql.Connection" level="WARN" additivity="true">
            <AppenderRef ref="RoFile" />
        </Logger>
        <Logger name="java.sql.PreparedStatement" level="WARN" additivity="true">
            <AppenderRef ref="RoFile" />
        </Logger>
        <Logger name="java.sql.ResultSet" level="WARN" additivity="true">
            <AppenderRef ref="RoFile" />
        </Logger>
        <Logger name="kafka" level="WARN" additivity="true">
            <AppenderRef ref="RoFile" />
        </Logger>
        <Logger name="org.apache.zookeeper" level="ERROR" additivity="true">
            <AppenderRef ref="RoFile" />
        </Logger>
        <Logger name="org.acme" level="debug"
                additivity="true">
            <AppenderRef ref="AppLogFile" />
        </Logger>
        <Logger name="RequestLog" level="INFO"
                additivity="false">
            <AppenderRef ref="RequestLogFile" />
        </Logger>

        <root level="INFO">
            <appender-ref ref="RoFile" />
            <appender-ref ref="RoErrorFile" />
            <appender-ref ref="STDOUT" />
        </root>
    </loggers>

</Configuration>